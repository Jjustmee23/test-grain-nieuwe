{% load i18n %}
{% load static %}
<!DOCTYPE html>
<html dir="ltr" lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% trans "Control Panel" %}</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="{% static 'mill/css/index.css' %}">
</head>

<body>
    <div style="position: absolute; top: 10px; left: 10px;">
        <a href="?lang=en" style="margin-right: 10px;">English</a>
        <a href="?lang=ar">Arabic</a>
    </div>

    <!-- Dark mode toggle -->
    <div class="dark-mode-toggle" onclick="toggleDarkMode()">
        <!-- Dark mode SVG icon -->
    </div>

    <!-- Header section -->
    <div class="header">
        <img src="{% static 'mill/pictures/logo-left.png' %}" alt="Left Logo" class="logo-left">
        <div>
            <h1>{% trans 'General Company for Grain Processing' %}</h1>
            <h2>{% trans 'Mill Operation Monitoring System' %}</h2>
        </div>
        <img src="{% static 'mill/pictures/logo-right.png' %}" alt="Right Logo" class="logo-right">
    </div>

    <!-- Filters section with user info and logout -->
    <div class="filters">
        <div class="left-section">
            <div class="user-info">
                <span>{% trans 'Welcome, ' %}{{ user.username }}</span>
                <a href="{% url 'logout' %}" class="logout-button">{% trans 'Logout' %}</a>
                
                <!-- Only show Admin/Monitor dashboard link if user is a Monitor or Super Admin -->
                <a href="{% url 'manage_admin' %}" class="admin-button">{% trans 'Admin Dashboard' %}</a>
                
                <!-- Super Admin Dashboard only for Super Admins -->
                {% if is_super_admin %}
                    <a href="{% url 'super_admin:index' %}" class="super-admin-button">{% trans 'Super Admin Panel' %}</a>
                {% endif %}
                
                <a href="#" onclick="openProfilePopup()" class="profile-button">{% trans 'Profile' %}</a>
            </div>
        </div>
        <div class="form-group">
            <label for="cityDropdown">{% trans 'Select City:' %}</label>
            <select id="cityDropdown" name="cityDropdown" onchange="filterFactoriesByCity()">
                <option value="">{% trans 'Select City' %}</option>
                {% for city in cities %}
                <option value="{{ city.id }}" {% if selected_city_id == city.id %}selected{% endif %}>{{ city.name }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="form-group date-picker">
            <label for="datePicker">{% trans 'Select Date:' %}</label>
            <input type="date" id="datePicker" name="date" value="{{ current_date }}" />
        </div>
    </div>

    <!-- Content section -->
	<div class="content">
		<div class="factories-container">
			{% for factory in factories %}
			<div class="factory 
				{% if factory.status %}
					online
				{% elif not factory.error %}
					offline
				{% else %}
					error
				{% endif %} 
				{% if not factory.devices %}
					no-device
				{% endif %}" 
				data-city-id="{{ factory.city_id }}"
				onclick="{% if factory.devices %}handleFactoryClick({{ factory.id }}, {{ factory.devices|yesno:'true,false' }}){% endif %}">
				
				<h2 class="factory-name">{% trans 'Mill ' %}{{ factory.name }}</h2>

				<!-- Daily Total in Sacks -->
				<div class="data-section">
					<p class="total-today">
						<span class="label">{% trans "Today's Total:" %}</span> 
						<span class="value">{{ factory.daily_total }}</span> 
						<span class="unit">{% if factory.daily_total == 1 %}{% trans "sack" %}{% else %}{% trans "sacks" %}{% endif %}</span>
					</p>

					<!-- Weight in Tons -->
					<p class="total-tons">
						<span class="label">{% trans "Weight:" %}</span> 
						<span class="value">{{ factory.daily_tons|floatformat:2 }}</span> 
						<span class="unit">{% trans "tons" %}</span>
					</p>
				</div>

				<div class="animation-container">
					<img src="{% static 'mill/pictures/index/' %}{% if not factory.status or factory.error %}floubandstatis.gif{% else %}flouband.gif{% endif %}" alt="Mill animation" class="factory-animation">
				</div>
			</div>
			{% empty %}
			<p>{% trans "No factories found for this city." %}</p>
			{% endfor %}
		</div>
	</div>

    <!-- No devices popup -->
    <div id="noDevicesPopup" class="popup">
        <h3>{% trans 'No devices found for this mill' %}</h3>
        <p>{% trans 'Please attach a device to this mill first.' %}</p>
        <button id="closePopupButton">{% trans 'OK' %}</button>
    </div>

    <!-- Status bar -->
    <div class="status-bar" style="margin-top: auto;">
        <span>{% trans 'Daily total for all mills in this city:' %} <span id="total-daily">{{ city_daily_total }}</span></span>
        <span>{% trans 'Weekly total for all mills in this city:' %} <span id="total-week">{{ city_weekly_total }}</span></span>
        <span>{% trans 'Monthly total for all mills in this city:' %} <span id="total-month">{{ city_month_total }}</span></span>
        <span>{% trans 'Yearly total for all mills in this city (2023):' %} <span id="total-year-2023">{{ city_year_total }}</span></span>
    </div>

    <script src="{% static 'mill/js/index.js' %}"></script>
</body>

</html>
